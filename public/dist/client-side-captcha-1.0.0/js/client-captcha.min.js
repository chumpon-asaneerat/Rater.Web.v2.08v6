(function(t,i,o,s){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e={selector:"#captcha",text:null,randomText:!0,randomColours:!0,width:244,height:163,colour1:null,colour2:null,font:'normal 40px "Comic Sans MS", cursive, sans-serif',onSuccess:function(){alert("Correct!")},onFailure:function(){alert("wrong!")}},a=function(t){var i=this;this._settings=o.extend({},e,t||{}),this._container=o(this._settings.selector);var s=o("<div>").prependTo(this._container);this._canvas=o("<canvas>").appendTo(s).attr("width",this._settings.width).attr("height",this._settings.height),this._input=this._container.find(".user-text").on("keypress.captcha",function(t){13==t.which&&i.validate(i._input.val())}),this._button=this._container.find(".validate").on("click.captcha",function(){i.validate(i._input.val())}),this._buttonRefresh=this._container.find(".refresh").on("click.captcha",function(){i.generate()}),this._context=this._canvas.get(0).getContext("2d")};a.prototype={generate:function(){var t=this._context;null!=this._settings.text&&""!=this._settings.text||(this._settings.randomText=!0),this._settings.randomText&&this._generateRandomText(),this._settings.randomColours&&(this._settings.colour1=this._generateRandomColour(),this._settings.colour2=this._generateRandomColour());var i=t.createLinearGradient(0,0,this._settings.width,0);i.addColorStop(0,this._settings.colour1),i.addColorStop(1,this._settings.colour2),t.fillStyle=i,t.fillRect(0,0,this._settings.width,this._settings.height),t.fillStyle="rgba(255,255,255,0.65)",t.fillRect(0,0,this._settings.width,this._settings.height);var o=t.createLinearGradient(0,0,this._settings.width,0);o.addColorStop(0,this._settings.colour2),o.addColorStop(1,this._settings.colour1),t.font=this._settings.font,t.fillStyle=o,t.setTransform(Math.random()/10+.9,.1-Math.random()/5,.1-Math.random()/5,Math.random()/10+.9,20*Math.random()+10,100),t.fillText(this._settings.text,0,0),t.setTransform(1,0,0,1,0,0);for(var s=Math.floor(3*Math.random()+5),n=0;n<s;n++)this._drawRandomCurve()},validate:function(t){t===this._settings.text?this._settings.onSuccess():this._settings.onFailure()},_drawRandomCurve:function(){var t=this._context,i=t.createLinearGradient(0,0,this._settings.width,0);i.addColorStop(0,Math.random()<.5?this._settings.colour1:this._settings.colour2),i.addColorStop(1,Math.random()<.5?this._settings.colour1:this._settings.colour2),t.lineWidth=Math.floor(4*Math.random()+2),t.strokeStyle=i,t.beginPath(),t.moveTo(Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height)),t.bezierCurveTo(Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height),Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height),Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height)),t.stroke()},_generateRandomText:function(){this._settings.text="";for(var t=Math.floor(3*Math.random()+6),i=0;i<t;i++)this._settings.text+=n.charAt(Math.floor(Math.random()*n.length))},_generateRandomColour:function(){return"rgb("+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+")"}},o.Captcha=a||{}})(window,document,jQuery);